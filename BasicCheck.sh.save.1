#!/bin/bash

dir_path=$1
makeArgu=$2
program=a.out
com=0
mem=0
thread=0


touch temp.txt
cd $dir_path

make MAIN=$makeArgu ----log-f
if [ $? -eq 0 ]; then
    echo OK, $program
else
    com=4
    echo compilation FAIL 
    rm temp
    exit #$com
fi

echo "output make is" $output

echo "run",$program


echo "val"
valgrind --tool=helgrind --error-exitcode=1 --log-file=temp  ./$program
if [ $? -eq 1 ]; then
    echo fail thread
    tread=1
else
    echo ok thred
fi
valgrind --leak-check=full --error-exitcode=2 --log-file=temp  ./$program

if [ $? -eq 2 ]; then
     mem=2
    echo fail $mem
else
    echo ok $mem
fi

echo "BasicCheck.sh" $dir_path $makeArgu \n \t compilation

rm temp
exit #$((mem+tread+com))
